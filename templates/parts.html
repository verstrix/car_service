{% extends "base.html" %}
{# parts template updated: 2026-02-17  UTC #}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Инвентар на части</h3>
  <div class="ms-3 text-muted small">Card view enabled — updated 2026-02-17</div>
  {% if current_user.role == 'manager' %}
    <button class="btn btn-sm btn-primary" data-bs-toggle="collapse" data-bs-target="#addPartForm">
      Добави част
    </button>
  {% endif %}
</div>

{% if current_user.role == 'manager' %}
<div class="collapse mb-3" id="addPartForm">
  <div class="card card-body">
    <form method="post" enctype="multipart/form-data">
      <div class="row g-2">
        <div class="col-md-3">
          <input class="form-control" name="part_number" placeholder="Номер на част" required>
        </div>
        <div class="col-md-3">
          <input class="form-control" name="name" placeholder="Име" required>
        </div>
        <div class="col-md-2">
          <input class="form-control" name="quantity" placeholder="Количество" type="number">
        </div>
        <div class="col-md-2">
          <input class="form-control" name="unit_price" placeholder="Цена за брой" type="number" step="0.01">
        </div>
        <div class="col-md-12 mt-2">
          <textarea class="form-control" name="description" placeholder="Описание"></textarea>
        </div>
        <div class="col-md-4 mt-2">
          <label class="form-label">Изображение (по избор)</label>
          <input class="form-control" type="file" name="image" accept="image/*">
        </div>
      </div>
      <button class="btn btn-success mt-3" type="submit">Запази</button>
    </form>
  </div>
</div>
{% endif %}

<div class="parts-list">
  {% for part in parts %}
    <div class="part-item">
      <div class="part-image">
        {% if part.image_filename %}
          <img src="{{ url_for('static', filename=part.image_filename) }}" alt="{{ part.name }}">
        {% else %}
          <div class="no-image">
            <i class="bi bi-box"></i>
          </div>
        {% endif %}
      </div>
      
      <div class="part-info">
        <h5 class="part-name"><a href="{{ url_for('parts.part_details', part_id=part.id) }}">{{ part.name }}</a></h5>
        <p class="part-number">{{ part.part_number }}</p>
        <p class="part-description">{{ part.description[:80] }}{% if part.description|length > 80 %}...{% endif %}</p>
        
        <div class="part-meta">
          <span class="meta-item">
            <strong>{{ part.quantity }}</strong> in stock
          </span>
          <span class="meta-item price">
            {{ "%.2f"|format(part.unit_price) }} лв.
          </span>
        </div>
      </div>
      
      <div class="part-actions">
        <a class="btn btn-sm btn-primary" href="{{ url_for('parts.part_details', part_id=part.id) }}">
          <i class="bi bi-eye"></i> View
        </a>
        {% if current_user.role == 'manager' %}
          <form method="post" action="{{ url_for('parts.delete_part', part_id=part.id) }}" onsubmit="return confirm('Наистина ли искате да изтриете тази част?');">
            <button class="btn btn-sm btn-outline-danger">
              <i class="bi bi-trash"></i>
            </button>
          </form>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>

{% endblock %}
